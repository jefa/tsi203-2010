<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">



<ui:composition template="templates/superusuarioUI.xhtml">
	<ui:define name="title">Ver Evento</ui:define>
	<ui:define name="styles">
	.main-aside {width:300px;}
	#container {width:660px;}
	#content {width:660px;} 
	</ui:define>

	<ui:define name="body">
		<script type="">
			function toggleTab(control, tab)
			{
				jQuery('div.ui-tabs-panel').addClass('ui-tabs-hide');
				jQuery('#' + control).fadeIn();
				jQuery('#' + control).removeClass('ui-tabs-hide');
				jQuery('ul.ui-tabs-nav li').removeClass('ui-tabs-selected ui-state-active');
				jQuery(tab.parentNode).addClass('ui-tabs-selected ui-state-active');
				jQuery("#ulCategories li." + document.getElementById("formThumb:catName").value).addClass("ui-tabs-selected ui-state-active");
			}
		</script>
		<link rel="stylesheet" href="styles/pikachoose/styles.css"
			type="text/css" />
		<link rel="stylesheet" href="styles/lightbox/jquery.lightbox-0.5.css"
			type="text/css" />
		<script type="text/javascript" src="scripts/jquery.pikachoose.js"></script>
		<script type="text/javascript" src="scripts/jquery.jcarousel.js"></script>
		<script type="text/javascript" src="scripts/jquery.lightbox-0.5.js"></script>

		<h:panelGroup id="panelEvento">
			<div id="index-featured2">
			<ul class="hfeed posts-quick clearfix">
				<li class="post type-post clearfix">
				<div class="entry-thumbnails"><h:graphicImage
					value="/ContentFeeder?id=#{eventoMB.evento.coverId}&#38;thb=115"
					styleClass="attachment-quick-preview-thumb wp-post-image" /></div>
				<h3 class="entry-title">#{eventoMB.evento.evtName}</h3>
				<div class="entry-summary">
				<div class="entry-info"><abbr class="published">#{eventoMB.evento.formattedDate}</abbr>
				</div>
				<div class="entry-info"><abbr class="published">#{eventoMB.evento.description}</abbr>
				</div>
				<h:inputHidden id="hiddenHashtag" value="#{eventoMB.evento.hashtag}" />
				</div>
				<h:form id="formUploadContent"
					rendered="#{eventoMB.validUserForContext}">
					<h:commandButton value="Añadir fotos" action="subirFoto">
						<f:setPropertyActionListener value="#{eventoMB.eventId}"
							target="#{subirFotoMB.idEvento}" />
					</h:commandButton>
					<h:commandButton value="Añadir videos" action="subirVideo">
						<f:setPropertyActionListener value="#{eventoMB.eventId}"
							target="#{subirVideoMB.eventId}" />
					</h:commandButton>
					<h:commandButton value="Modificar Album" action="modificarAlbum">
						<f:setPropertyActionListener value="#{eventoMB.album}"
							target="#{eventoMB.selectedCategory}" />
					</h:commandButton>
					<h:commandButton value="Modificar Evento" action="modEvento">
						<f:setPropertyActionListener value="#{eventoMB.eventId}"
								target="#{EventMB.evt_id}" />
					</h:commandButton>
				</h:form></li>
			</ul>
			<!-- .posts-quick --></div>
			<!-- #index-featured2 -->
		</h:panelGroup>

		<h:panelGroup id="notPublicContent"
			rendered="#{!loginMB.isUserLogged and !eventoMB.hasAlbum}">
			<h:outputText>Debe loguearse para ver el contenido de este evento.</h:outputText>
			<br />
		</h:panelGroup>

		<h:panelGroup id="notAuthorizedContent"
			rendered="#{!eventoMB.validUserForContext and loginMB.isUserLogged}">
			<h:outputText>Usted no esta autorizado a ver contenido privado de este evento.</h:outputText>
			<br />
			<h:outputText>Puede solicitar autorizacion enviando un mensaje al moderador.</h:outputText>
			<br />
			<h:commandButton value="Enviar solicitud" />
		</h:panelGroup>
		<h:panelGroup id="authorizedContent"
			rendered="#{eventoMB.validUserForContext || (eventoMB.hasAlbum and eventoMB.isAlbumFinalized)}">
			<a4j:outputPanel id="panelCategories">
				<h:form id="formCategory">
					<h:inputHidden id="catName"
						value="#{eventoMB.selectedCategory.category}" />
					<script>
						jQuery("#ulCategories li").removeClass("ui-tabs-selected ui-state-active");
						jQuery("#ulCategories li." + document.getElementById("formCategory:catName").value).addClass("ui-tabs-selected ui-state-active");
					</script>

					<div
						class="multi-sidebar clearfix ui-tabs ui-widget ui-widget-content ui-corner-all">
					<ul id="ulCategories"
						class="tabs clearfix ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
						<a4j:repeat var="category" value="#{eventoMB.categories}">
							<li class="ui-state-default ui-corner-top #{category.category}"><a
								href="javascript:null()"
								onclick="toggleTab('s-'+#{category.category},this)"> <a4j:commandLink
								value="#{category.category}" action="#{eventoMB.updateCategory}"
								reRender="authorizedContent,panelTags,panelComments">
								<f:setPropertyActionListener target="#{eventoMB.categoryId}"
									value="#{category.categoryId}" />
							</a4j:commandLink> </a></li>
						</a4j:repeat>
					</ul>
					</div>
					<h:inputHidden id="cntType" value="#{eventoMB.firstContentType}" />
					<h:inputHidden id="cntUrl" value="#{eventoMB.firstContentUrl}" />

				</h:form>
			</a4j:outputPanel>
			<a4j:outputPanel id="panelNoContents"
				rendered="#{eventoMB.contentsCount == 0}">
			No hay contenidos para esta categ
			</a4j:outputPanel>

			<a4j:form id="panelThumbs" rendered="#{eventoMB.contentsCount > 0}">
				<div class="pikachoose" style="height: 620px;"><h:inputHidden
					id="selectContentId" value="#{eventoMB.contentId}" /> <a4j:commandButton
					id="btnSelectThumb" action="#{eventoMB.updateCategory}"
					reRender="panelRating,panelTags,panelComments"
					style="display:none;">
				</a4j:commandButton>
				<ul id="pikame" class="jcarousel-skin-pika">
					<a4j:repeat value="#{eventoMB.selectedCategory.contents}"
						var="content">
						<li><h:graphicImage
							value="/ContentFeeder?id=#{content.contId}"
							name="#{content.contId}"
							onclick="document.getElementById('cntType').setAttribute('value','#{content.type}'); document.getElementById('cntUrl').setAttribute('value','#{content.url}');" />
						<span>#{content.description}</span></li>
					</a4j:repeat>
				</ul>
				<script>
					jQuery("#pikame").PikaChoose();
					jQuery("#pikame").jcarousel({scroll:5,					
						initCallback: function(carousel) {
					        $(carousel.list).find('img').click(function() {
				          		carousel.scroll(parseInt($(this).ancestors()[1].getAttribute('jcarouselindex')));
				        	});
					    }
			    	});
					var img = jQuery(".pika-image a.image-selected");
					img.lightBox();
			    </script></div>

				<h:panelGroup
					rendered="#{eventoMB.albumExists and !eventoMB.isAlbumFinalized}">
					<h:panelGroup rendered="#{eventoMB.isInAlbum}">
						<a4j:commandButton value="Quitar del Album"
							action="#{eventoMB.quitarContenidoAlbum}"
							reRender="authorizedContent,panelTags,panelComments" />
					</h:panelGroup>
					<h:panelGroup rendered="#{!eventoMB.isInAlbum}">

						<h:column>
							<a4j:commandButton value="Agregar al Album"
								action="#{eventoMB.agregarContenidoAlbum}"
								reRender="panelContent" />
						</h:column>
						<h:column>
							<a4j:commandLink
								onclick="if(!confirm('¿Eliminar el contenido?'))return false;"
								value="Eliminar contenido" action="#{eventoMB.removeContent}"
								reRender="authorizedContent,panelTags,panelComments,panelCategories"
								style="float:right;">
								<h:graphicImage value="/images/close.png"
									alt="Eliminar contenido" />
							</a4j:commandLink>
						</h:column>
					</h:panelGroup>
				</h:panelGroup>

			</a4j:form>

			<a4j:outputPanel id="panelRating" rendered="#{eventoMB.contentsCount > 0}">
				<h:column styleClass="Clear">
					<h:outputText value="Calificación global: " />
					<h:form id="formGlobalRating">
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="0.5" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="1" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="1.5" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="2" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="2.5" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="3" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="3.5" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="4" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="4.5" />
						<input type="radio" class="hover-star {half:true}"
							name="globalRating" value="5" />
						<rich:jQuery selector="#formGlobalRating .hover-star"
							query="rating({}).rating('select', #{eventoMB.selectedContent == null ? 0 : eventoMB.selectedContent.avgScore} + '').rating('readOnly', true);"></rich:jQuery>
					</h:form>
				</h:column>
			</a4j:outputPanel>
		</h:panelGroup>
	</ui:define>
	<ui:define name="sidebar"
		rendered="#{eventoMB.validUserForContext and (eventoMB.contentsCount > 0)}">
		<ul class="xoxo" id="ulSidebar">
			<li class="multi-sidebar-container">
			<div
				class="multi-sidebar clearfix ui-tabs ui-widget ui-widget-content ui-corner-all">
			<ul
				class="tabs clearfix ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li
					class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a
					href="javascript:null()" onclick="toggleTab('s-etiquetados',this)"><span>Etiquetados</span></a></li>
				<li class="ui-state-default ui-corner-top"><a
					href="javascript:null()" onclick="toggleTab('s-comentarios',this)"><span>Comentarios</span></a></li>
				<li class="ui-state-default ui-corner-top"><a
					href="javascript:null()" onclick="toggleTab('s-twitter',this)"><span>Twitter</span></a></li>
			</ul>
			<div id="s-etiquetados"
				class="widgetcontainer clearfix ui-tabs-panel ui-widget-content ui-corner-bottom">
			<a4j:outputPanel id="panelTags"
				rendered="#{eventoMB.contentsCount > 0}">
				<h:form id="tagPublicProfile">
					<div id="index-featured2">
					<ul class="hfeed posts-quick-tag clearfix">
						<a4j:repeat value="#{eventoMB.selectedContent.tags}" var="tag">
							<li class="post type-post clearfix">
							<div class="entry-thumbnails-tag"><h:commandLink
								rendered="#{tag.isRealUser}" action="verPerfil"
								styleClass="entry-thumbnails-link">
								<f:setPropertyActionListener value="#{tag.userName}"
									target="#{PublicProfile.userId}" />
								<h:graphicImage
									value="/UserImageFeeder?username=#{tag.userName}&#38;thb=50"
									styleClass="attachment-quick-preview-thumb wp-post-image" />
							</h:commandLink> <h:graphicImage rendered="#{!tag.isRealUser}"
								value="/UserImageFeeder?username=__unr_#{tag.userName}&#38;thb=50"
								styleClass="attachment-quick-preview-thumb wp-post-image" /></div>
							<h5 class="entry-title"><h:commandLink
								rendered="#{tag.isRealUser}" value="#{tag.name}"
								action="verPerfil">
								<f:setPropertyActionListener value="#{tag.userName}"
									target="#{PublicProfile.userId}" />
							</h:commandLink> <h:outputText rendered="#{!tag.isRealUser}" value="#{tag.name}" />
							</h5>
							</li>
						</a4j:repeat>
					</ul>
					<!-- .posts-quick --></div>
					<!-- #index-featured2 -->
				</h:form>
			</a4j:outputPanel></div>

			<div id="s-comentarios"
				class="widgetcontainer clearfix ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">
			<a4j:outputPanel id="panelComments"
				rendered="#{eventoMB.contentsCount > 0}">
				<h:panelGroup layout="block" id="commentPanel">
					<h:form id="formComments">
						<div id="index-featured2">
						<ul class="hfeed posts-quick-tag clearfix">
							<a4j:repeat value="#{eventoMB.selectedContent.comments}"
								var="comment">
								<li class="post type-post clearfix">
								<div class="entry-thumbnails-tag"><h:commandLink
									action="verPerfil" styleClass="entry-thumbnails-link">
									<f:setPropertyActionListener value="#{comment.userId}"
										target="#{PublicProfile.userId}" />
									<h:graphicImage
										value="/UserImageFeeder?username=#{comment.userId}&#38;thb=50"
										styleClass="attachment-quick-preview-thumb wp-post-image" />
								</h:commandLink></div>
								<a4j:commandLink
									onclick="if (!window.confirm('¿Eliminar el comentario #{comment.text}?')) {return false}"
									action="#{eventoMB.removeComment}" reRender="panelComments"
									style="float:right;">
									<f:setPropertyActionListener value="#{comment.userId}"
										target="#{eventoMB.commentToRemoveUser}" />
									<f:setPropertyActionListener value="#{comment.text}"
										target="#{eventoMB.commentToRemoveText}" />
									<h:graphicImage value="/images/close.png"
										alt="Eliminar comentario" />
								</a4j:commandLink>

								<h5 class="entry-title"><h:commandLink
									value="#{comment.userName}" action="verPerfil">
									<f:setPropertyActionListener value="#{comment.userId}"
										target="#{PublicProfile.userId}" />
								</h:commandLink></h5>
								<div class="entry-summary">#{comment.text}</div>
								</li>
							</a4j:repeat>
						</ul>
						<!-- .posts-quick --></div>
						<!-- #index-featured2 -->
					</h:form>
				</h:panelGroup>
			</a4j:outputPanel></div>
			<div id="s-twitter"
				class="widgetcontainer clearfix ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">
			<h:form id="formTwitter">
				<h:inputHidden id="hiddenHashtag" value="#{eventoMB.evento.hashtag}" />
				<div id="index-featured2">
				<ul id="twitter" class="hfeed posts-quick-tag clearfix">
				</ul>
				</div>
			</h:form> <script type="text/javascript">
		//<![CDATA[
        var twitterQuery = encodeURIComponent (document.getElementById("formTwitter:hiddenHashtag").value);
        var requestUrl = "http://search.twitter.com/search.json?q=@query&show_user=true&rpp=10&callback=?".
            replace (/@query/g, twitterQuery);
            
        jQuery.getJSON (requestUrl, function (data)
        {
			jQuery.each(data.results, function (i, tweet)
			{
                
                var date_tweet = new Date(tweet.created_at);
                var date_now   = new Date();
                var date_diff  = date_now - date_tweet;
                var hours      = Math.round(date_diff/(1000*60*60));

                var tweet_html = '<li class="post type-post clearfix">';
				tweet_html += '<div class="entry-thumbnails-tag">';
                tweet_html += '<a href="' + tweet.from_user + '" target="_blank">';
                tweet_html += '<img src="' + tweet.profile_image_url + '" style="display:inline;" /></a>'
				tweet_html += '<h5 class="entry-title"><a href="http://twitter.com/' + tweet.from_user + '" target="_blank">';
				tweet_html += tweet.from_user + '</a></h5>';
				tweet_html += '<div class="entry-summary">' + tweet.text + '</div>';
                tweet_html += '<div class="tweet_hours">' + hours;
                tweet_html += ' hours ago</div>';
				tweet_html += '</div>';
                tweet_html += '</li>';
                jQuery('#twitter').append(tweet_html);
			});
        });
      //]]>
		</script></div>
			</div>
			</li>
		</ul>
	</ui:define>
</ui:composition>
</html>