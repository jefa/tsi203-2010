<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="templates/superusuarioUI.xhtml">
	<ui:define name="title">Modificar un Evento</ui:define>
	<ui:define name="body">
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="scripts/googlemaps.js"></script> 
	<h:form id="EditEvent">
		<f:view>
			<rich:panel>
				<f:facet name="header">
					<h:outputText value="Modificar Evento"></h:outputText>
				</f:facet>
				
				<h:outputText value="Busqueda de evento:"/><br/>
				<h:inputText id="findEvent" value="#{EventMB.findName}" size="50" style="margin-right:5px"/>
				<h:commandButton value="Buscar Evento" action="#{EventMB.searchEvent}"/><br/>
				<h:outputText vaue="#{EventMB.findEventMessage}"/>
				<rich:suggestionbox id="eventSuggestionBoxId" for="findEvent" tokens=",["
					suggestionAction="#{EventMB.findEventAutocomplete}" var="eventResult"
					nothingLabel="No hay eventos que coincidan" columnClasses="center">
					<!-- h:column>
						<h:outputText value="#{eventResult.evtId}" />
					</h:column-->
					<h:column>
						<h:outputText value="#{eventResult.evtName}" />
					</h:column>
				</rich:suggestionbox>
			
				<br/><br/>
				
				<h:panelGrid columns="2">
					<h:panelGroup>
						<h:outputText value="Nombre del evento:"></h:outputText><br/>
						<h:inputText value="#{EventMB.name}" size="60" style="margin-right:5px"></h:inputText>
							<h:outputText value="#{EventMB.nameMessage}" style="color:red"></h:outputText><br/>
						
						<h:outputText value="Categoría:"/><br/>
						<h:selectOneMenu value="#{EventMB.category}">
							<f:selectItems value="#{EventMB.allCats}" />
						</h:selectOneMenu><br/><br/>	
							
						<h:outputText value="Descripción:"></h:outputText><br/>
						<h:inputText value="#{EventMB.description}" size="60"></h:inputText>
							<h:outputText value="#{EventMB.descriptionMessage}" style="color:red"></h:outputText><br/>
						<h:outputText value="Fecha:"></h:outputText><br/>				
						<rich:calendar value="#{EventMB.date}"
		                    datePattern="d/MMM/y"  showApplyButton="false"  
		                    cellWidth="24px" cellHeight="22px" style="width:200px"/><br/>
						<h:outputText value="Horario:"></h:outputText><br/>
						<h:inputText value="#{EventMB.duration}" size="60"></h:inputText>
							<h:outputText value="#{EventMB.durationMessage}" style="color:red"></h:outputText><br/>
						<h:outputText value="Dirección:"></h:outputText><br/>
						<h:inputText id="address" value="#{EventMB.address}" size="60"></h:inputText>
							<h:outputText value="#{EventMB.addressMessage}" style="color:red"></h:outputText><br/>
						
						<input type="button" value="Buscar Dirección" onclick="showAddress('EditEvent:address', map, 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');"/>
			        	<input type="button" value="Borrar Marcadores" onclick="eraseMarkers(map,'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');"/><br/>
			        	
			            <h:inputHidden id="hidden_coord_lat" value="#{EventMB.latitude}" /><br/>
			            <h:inputHidden id="hidden_coord_lng" value="#{EventMB.longitude}"/><br/>
			            
			            <h:outputText value="Hashtag de Twitter:"/><br/>
						<h:inputText value="#{EventMB.hashtag}" size="60"></h:inputText>
						
			            <table border='1' id='markerTable'>
						<tbody>
						</tbody>
						</table>					
						
					 </h:panelGroup>
					<h:panelGroup>
			        	<rich:gmap  gmapVar="map" style="width:400px;height:400px" id="map" lat="-34.831" lng="-56.2055"  enableDoubleClickZoom="true"
			        zoom="11" mapType="G_NORMAL_MAP"/>
			        </h:panelGroup>
				</h:panelGrid>
				
				<a4j:outputPanel id="participantsPanel">
						<h:inputText id="newParticipant" value="#{EventMB.suggestParticipants}" />
						<a4j:commandButton value="Agregar como participante" action="#{EventMB.addParticipant}" reRender="participantsPanel"/>
						<a4j:commandButton value="Limpiar lista" action="#{EventMB.resetParticipants}" reRender="participantsPanel"/>
						<rich:suggestionbox id="suggestionBoxIdParticipant" for="newParticipant" tokens=",["
							suggestionAction="#{EventMB.autocompleteParticipants}" var="result"
							nothingLabel="No hay usuarios que coincidan" columnClasses="center">
							<h:column>
								<h:outputText value="#{result.username}" />
							</h:column>
							<h:column>
								<h:outputText value="#{result.name}" />
							</h:column>
						</rich:suggestionbox>
						<rich:panel style="width:50%">
				            <f:facet name="header">
				                <h:outputText value="Participantes"/>
				            </f:facet>
				            <rich:dataList value="#{EventMB.participants}" var="pickList" rendered="#{EventMB.cantParticipants>0}">
				            	<h:outputText value="#{pickList}"/>
				            </rich:dataList> 
				        </rich:panel>
				        <h:outputText value="#{EventMB.participantsMessage}" style="color:red"></h:outputText><br/>
				</a4j:outputPanel>
				
				<a4j:outputPanel id="modPanel">
				<h:outputText value="Evento es moderado:"/>
						<h:selectBooleanCheckbox id="check" value="#{EventMB.moderated}" 
						onclick="toggleVisibility('divNewMod','EditEvent:check');" /><br/><br/>
						<div id="divNewMod">
						<h:inputText id="newMod" value="#{EventMB.suggestMods}" />
						<a4j:commandButton value="Agregar como moderador" action="#{EventMB.addMod}" reRender="modPanel"/>
						<a4j:commandButton value="Limpiar lista" action="#{EventMB.resetMod}" reRender="modPanel"/>
						<rich:suggestionbox id="suggestionBoxIdMod" for="newMod" tokens=",["
							suggestionAction="#{EventMB.autocompleteMods}" var="result"
							nothingLabel="No hay usuarios que coincidan" columnClasses="center">
							<h:column>
								<h:outputText value="#{result.username}" />
							</h:column>
							<h:column>
								<h:outputText value="#{result.name}" />
							</h:column>
						</rich:suggestionbox>
						<rich:panel style="width:50%">
				            <f:facet name="header">
				                <h:outputText value="Moderadores"/>
				            </f:facet>
				            <rich:dataList value="#{EventMB.mods}" var="pickList" rendered="#{EventMB.cantMods>0}">
				            	<h:outputText value="#{pickList}"/>
				            </rich:dataList> 
				        </rich:panel>
				        <h:outputText value="#{EventMB.modsMessage}" style="color:red"></h:outputText><br/>
				        </div>
				</a4j:outputPanel>	        
				        
			   <!--Inicializamos el geoCoder-->
			   <script>window.onload=function(){
				   initGeoCoder(map, 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');
				   toggleVisibility('divNewMod','EditEvent:check');
				   addMarkerWithInfo(map, "#{EventMB.latitude}", "#{EventMB.longitude}", '', 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');
				}</script>
					   
				<center>
				        
				<h:commandButton value="Confirmar cambios" action="#{EventMB.updateEvent}">
					<f:setPropertyActionListener value="#{loginMB.userName}"
								target="#{EventMB.creator}" />
				</h:commandButton>
				<br/>
				</center>
			</rich:panel>
		</f:view>
	</h:form>
	</ui:define>
</ui:composition>
</html>