<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="templates/superusuarioUI.xhtml">
	<ui:define name="title">Modificar un Evento</ui:define>
	<ui:define name="body">
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="scripts/googlemaps.js"></script> 
	<h:form id="EditEvent">
		<f:view>
			<rich:panel>
				<f:facet name="header">
					<h:outputText value="Modificar Evento"></h:outputText>
				</f:facet>
				
				<h:outputText value="Busqueda de evento:"/><br/>
				<h:inputText id="findEvent" value="#{EventMB.findName}" size="50"/>
				<h:commandButton value="Buscar Evento" action="#{EventMB.searchEvent}"/><br/>
				<h:outputText vaue="#{EventMB.findEventMessage}"/>
				<rich:suggestionbox width="320" id="eventSuggestionBoxId" for="findEvent" tokens=",["
					suggestionAction="#{EventMB.findEventAutocomplete}" var="eventResult"
					nothingLabel="No hay eventos que coincidan" columnClasses="center">
					<!-- h:column>
						<h:outputText value="#{eventResult.evtId}" />
					</h:column-->
					<h:column>
						<h:outputText value="#{eventResult.evtName}" />
					</h:column>
				</rich:suggestionbox>
			
				<br/><br/>
				<center>
				<h:panelGrid columns="2">
					<h:panelGroup>
						<h:outputText value="Nombre del evento:"></h:outputText><br/>
						<h:inputText value="#{EventMB.nameM}" size="60" style="margin-right:5px"></h:inputText>
							<h:outputText value="#{EventMB.nameMessageM}" style="color:red"></h:outputText><br/>
						
						<br/><h:outputText value="Categoría:"/><br/>
						<h:selectOneMenu value="#{EventMB.categoryM}">
							<f:selectItems value="#{EventMB.allCats}" />
						</h:selectOneMenu><br/><br/>
							
						<h:outputText value="Descripción:"/><br/>
						<h:inputTextarea value="#{EventMB.descriptionM}" cols="45" rows="3"/>
							<h:outputText value="#{EventMB.descriptionMessageM}" style="color:red"/><br/>
						<br/><h:outputText value="Fecha:"/><br/>				
						<rich:calendar value="#{EventMB.dateM}"
		                    datePattern="d/MMM/y"  showApplyButton="false"  
		                    cellWidth="24px" cellHeight="22px" style="width:200px"/><br/>
						<br/><h:outputText value="Horario:"/><br/>
						<h:inputText value="#{EventMB.durationM}" size="60"/>
							<h:outputText value="#{EventMB.durationMessageM}" style="color:red"/><br/>
						<br/><h:outputText value="Dirección:"/><br/>
						<h:inputText id="address" value="#{EventMB.addressM}" size="60"/>
							<h:outputText value="#{EventMB.addressMessageM}" style="color:red"/><br/>
						
						<input type="button" value="Buscar Dirección" onclick="showAddress('EditEvent:address', map, 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');"/>
			        	<input type="button" value="Borrar Marcadores" onclick="eraseMarkers(map,'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');"/><br/>
			        	
			            <h:inputHidden id="hidden_coord_lat" value="#{EventMB.latitudeM}" /><br/>
			            <h:inputHidden id="hidden_coord_lng" value="#{EventMB.longitudeM}"/>
			            
			            <table border='1' id='markerTable'>
						<tbody>
						</tbody>
						</table>
						<br/>
			            
			            <h:outputText value="Hashtag de Twitter:"/><br/>
						<h:inputText value="#{EventMB.hashtagM}" size="60"></h:inputText>
						
			            					
						
					 </h:panelGroup>
					<h:panelGroup>
			        	<rich:gmap  gmapVar="map" style="width:400px;height:400px" id="map" lat="-34.831" lng="-56.2055"  enableDoubleClickZoom="true"
			        zoom="11" mapType="G_NORMAL_MAP"/>
			        </h:panelGroup>
				</h:panelGrid>
				</center>
				<br/><br/>
				
				<a4j:outputPanel id="participantsPanel">
					<rich:panel style="width:87%;margin-left:60px">
						<h:inputText id="newParticipant" value="#{EventMB.suggestParticipantsM}" size="60"/>
						<a4j:commandButton value="Agregar como participante" action="#{EventMB.addParticipantM}" reRender="participantsPanel"/>
						<a4j:commandButton value="Limpiar lista" action="#{EventMB.resetParticipantsM}" reRender="participantsPanel"/>
						<rich:suggestionbox id="suggestionBoxIdParticipant" for="newParticipant" tokens=",["
							suggestionAction="#{EventMB.autocompleteParticipantsM}" var="result"
							nothingLabel="No hay usuarios que coincidan" columnClasses="center">
							<h:column>
								<h:outputText value="#{result.username}" />
							</h:column>
							<h:column>
								<h:outputText value="#{result.name}" />
							</h:column>
						</rich:suggestionbox>
						
				            <f:facet name="header">
				                <h:outputText value="Participantes del evento"/>
				            </f:facet>
				            <br/><br/>
				           <h:outputText value="El evento no tiene ningún participante" style="font-style:italic" rendered="#{EventMB.cantParticipantsM eq 0}"/>
				            <rich:dataList value="#{EventMB.participantsM}" var="pickList" rendered="#{EventMB.cantParticipantsM>0}">
				            	<h:outputText value="#{pickList}"/>
				            </rich:dataList> 
				        </rich:panel>
				        <h:outputText value="#{EventMB.participantsMessageM}" style="color:red"></h:outputText><br/>
				</a4j:outputPanel>
				
				<hr/>
				
				<a4j:outputPanel id="modPanel" style="margin-left:60px">
				<h:outputText value="Evento es moderado:"/>
						<h:selectBooleanCheckbox id="effCheck" value="#{EventMB.moderatedM}" 
						onclick="if(document.getElementById('EditEvent:effCheck').checked) showDiv(); else hideDiv({duration:0.7});" /><br/><br/>
						<div id="divNewMod">
						<rich:panel style="width:87%;margin-left:60px" id="richModPanel">
						
						<h:inputText id="newMod" value="#{EventMB.suggestModsM}" size="60"/>
						<a4j:commandButton value="Agregar como moderador" action="#{EventMB.addModM}" reRender="modPanel"/>
						<a4j:commandButton value="Limpiar lista" action="#{EventMB.resetModM}" reRender="modPanel"/>
						<rich:suggestionbox id="suggestionBoxIdMod" for="newMod" tokens=",["
							suggestionAction="#{EventMB.autocompleteModsM}" var="result"
							nothingLabel="No hay usuarios que coincidan" columnClasses="center">
							<h:column>
								<h:outputText value="#{result.username}" />
							</h:column>
							<h:column>
								<h:outputText value="#{result.name}" />
							</h:column>
						</rich:suggestionbox>
						
				            <f:facet name="header">
				                <h:outputText value="Moderadores"/>
				            </f:facet>
				            <br/><br/>
				            <h:outputText value="El evento no tiene ningún moderador" style="font-style:italic" rendered="#{EventMB.cantModsM eq 0}"/>
				            <rich:dataList value="#{EventMB.modsM}" var="pickList" rendered="#{EventMB.cantModsM>0}">
				            	<h:outputText value="#{pickList}"/>
				            </rich:dataList> 
				        </rich:panel>
				        <h:outputText value="#{EventMB.modsMessageM}" style="color:red"></h:outputText><br/>
				        </div>
				</a4j:outputPanel>	        
				        
			   <!--Inicializamos el geoCoder-->
			   <script>window.onload=function(){
				   initGeoCoder(map, 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');
				   addMarkerWithInfo(map, "#{EventMB.latitudeM}", "#{EventMB.longitudeM}", '', 'EditEvent:hidden_coord_lat', 'EditEvent:hidden_coord_lng');
				   if(document.getElementById('EditEvent:effCheck').checked) 
						showDiv(); 
					else 
						hideDiv({duration:0.7});
				}</script>
					   
				<rich:effect  name="hideDiv"  for="richModPanel" type="BlindUp" />
				<rich:effect  name="showDiv"  for="richModPanel" type="BlindDown" />	   
				
    
				<center>
				        
				<h:commandButton value="Confirmar cambios" action="#{EventMB.updateEvent}">
					<f:setPropertyActionListener value="#{loginMB.userName}"
								target="#{EventMB.creatorM}" />
				</h:commandButton>
				<br/>
				</center>
			</rich:panel>
		</f:view>
	</h:form>
	</ui:define>
</ui:composition>
</html>