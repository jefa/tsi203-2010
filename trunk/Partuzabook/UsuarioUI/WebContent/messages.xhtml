<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
<ui:composition template="templates/usuarioUI.xhtml">
	<ui:define name="title">Mensajeria</ui:define>
	<ui:define name="body">
	
		<script type="text/javascript" src="scripts/googlemaps.js"></script>
	
		<rich:modalPanel id="panel" width="700" height="400">
			<f:facet name="header">
		        	<h:outputText value="Mensaje"/>
			</f:facet>
						
				<h:panelGrid columns="2" elements="1" width="100%">
					<h:column>
						<h:graphicImage value="/UserImageFeeder?username=#{loginMB.userName}&#38;thb=150" style="padding-bottom: 4px; vertical-align: middle;"/>
					</h:column>
					<h:column>
						<div id="modalSubject"/>
						<hr/>
						<div id="modalInfo"/>
						<br/>
						<div id="modalBody"/>
						<div id="modalTo" style="display: none"/>
					</h:column>
					
				</h:panelGrid>
			
			<center>
				<a4j:commandButton reRender="write" value="Responder" id="reply" 
					onclick="document.getElementById('j_id71:toField').value = document.getElementById('modalTo').innerHTML; document.getElementById('j_id71:subjectField').value = 'Re: ' + noStrong(document.getElementById('modalSubject').innerHTML); "/>
				<rich:componentControl for="panel" attachTo="reply" operation="hide" event="onclick"/>
				<rich:effect event="onclick"  for="reply"  type="BlindDown" targetId="write"/>
				<rich:effect event="onclick"  for="reply"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="reply"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="reply"  type="Fade" targetId="notif"/>
				<h:commandButton value="Cerrar" id="hidelink"/>
				<rich:componentControl for="panel" attachTo="hidelink" operation="hide" event="onclick"/>
			</center>
		</rich:modalPanel>
	
		<center>		
			
				<h:graphicImage id="w1" value="images/messages/msg_write.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				<h:outputText id="w2" value="Redactar" style="margin-right:15px; margin-left:5px"/>
				<rich:effect event="onclick"  for="w1"  type="BlindDown" targetId="write"/>
				<rich:effect event="onclick"  for="w1"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="w1"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="w1"  type="Fade" targetId="notif"/>
				<rich:effect event="onclick"  for="w2"  type="BlindDown" targetId="write"/>
				<rich:effect event="onclick"  for="w2"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="w2"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="w2"  type="Fade" targetId="notif"/>
				<h:graphicImage id="i1" value="images/messages/msg_inbox.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				<h:outputText id="i2" value="Bandeja de Entrada" style="margin-right:15px; margin-left:5px"/>
				<rich:effect event="onclick"  for="i1"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="i1"  type="BlindDown" targetId="inbox"/>
				<rich:effect event="onclick"  for="i1"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="i1"  type="Fade" targetId="notif"/>
				<rich:effect event="onclick"  for="i2"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="i2"  type="BlindDown" targetId="inbox"/>
				<rich:effect event="onclick"  for="i2"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="i2"  type="Fade" targetId="notif"/>
				<h:graphicImage id="s1" value="images/messages/msg_sentbox.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				<h:outputText id="s2" value="Elementos Enviados" style="margin-right:15px; margin-left:5px"/>
				<rich:effect event="onclick"  for="s1"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="s1"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="s1"  type="BlindDown" targetId="sentbox"/>
				<rich:effect event="onclick"  for="s1"  type="Fade" targetId="notif"/>
				<rich:effect event="onclick"  for="s2"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="s2"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="s2"  type="BlindDown" targetId="sentbox"/>
				<rich:effect event="onclick"  for="s2"  type="Fade" targetId="notif"/>
				<h:graphicImage id="n1" value="images/messages/msg_notif.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				<h:outputText id="n2" value="Notificaciones" style="margin-left:5px"/>
				<rich:effect event="onclick"  for="n1"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="n1"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="n1"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="n1"  type="BlindDown" targetId="notif"/>
				<rich:effect event="onclick"  for="n2"  type="Fade" targetId="write"/>
				<rich:effect event="onclick"  for="n2"  type="Fade" targetId="inbox"/>
				<rich:effect event="onclick"  for="n2"  type="Fade" targetId="sentbox"/>
				<rich:effect event="onclick"  for="n2"  type="BlindDown" targetId="notif"/>
		</center>
		<br/><br/>
			<rich:panel id="write">	
				<f:facet name="header">
					<h:outputText value="Redactar nuevo Mensaje Privado"/>
				</f:facet>
				<h:form>
					<h:outputText value="Para:" style="margin-right:23px"/>
					<h:inputText id="toField" value="#{notificationsBean.toUser}" size="60"/>
					<h:outputText value="#{notificationsBean.toUserMessage}" style="color:red"/>
					<rich:suggestionbox width="360" id="suggestionBoxId" for="toField" tokens=",[]"
	                   suggestionAction="#{notificationsBean.autocomplete}" var="result"
	                   fetchValue="#{result.username}"
						nothingLabel="No hay usuarios que coincidan" columnClasses="center">
	                    <h:column>
	                        <h:graphicImage value="/UserImageFeeder?username=#{result.username}&#38;thb=30" />
	                    </h:column>
	                    <h:column>
	                        <h:outputText value="#{result.name}" />
	                    </h:column>
	                    <h:column>
	                        <h:outputText value=" #{result.username}" style="font-style:italic" />
	                    </h:column>
	                </rich:suggestionbox>
					<br/><br/>
					<h:outputText value="Asunto:" style="margin-right:10px"/>
					<h:inputText id="subjectField" value="#{notificationsBean.subject}" size="60"/><br/><br/>
					<h:outputText value="Mensaje: "/>
					<h:outputText value="#{notificationsBean.bodyMessage}" style="color:red"/><br/>
					<h:inputTextarea value="#{notificationsBean.body}" cols="113" rows="9"/><br/>
					
					<center>
						<h:commandButton value="Enviar Mensaje" action="#{notificationsBean.sendMail}"/>
					</center>
				</h:form>		
			</rich:panel>
			
			
				<rich:panel id="inbox">
					<f:facet name="header">
						<h:outputText value="Bandeja de Entrada"/>
					</f:facet>
					<a4j:form>
						<p align="right">
							<a4j:commandButton value="Anterior" reRender="inbox" action="#{notificationsBean.recvNotificationsPreviousPage}"/>
							<em><h:outputText value=" Pagina #{notificationsBean.recvNotificationsPage} de #{notificationsBean.maxRecvNotificationsPage} "/></em>
							<a4j:commandButton value="Siguiente" reRender="inbox" action="#{notificationsBean.recvNotificationsNextPage}"/><br/>
						</p>
						<rich:dataGrid id="inboxDataGrid" value="#{notificationsBean.notificacionesRecibidas}" var="notif" columns="1" elements="10" width="938px" 
						onRowClick="document.getElementById('modalSubject').innerHTML = '&lt;strong&gt;#{notif.subject}&lt;/strong&gt;'; 
						document.getElementById('modalInfo').innerHTML = 'De #{notif.userFrom} Para #{notif.userTo}, #{notif.formattedDate}'; 
						document.getElementById('modalBody').innerHTML = '#{notif.HTMLText}'; document.getElementById('modalTo').innerHTML = '#{notif.userFrom}';
						#{rich:component('panel')}.show()">
							
					        	<h:graphicImage value="images/messages/msg_write.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
					        	<strong><h:outputText value="#{notif.subject}" style="margin-left:5px"/></strong><br />
					        	<h:outputText value="#{notif.userFrom} - " style="font-style:italic"/>
				                <h:outputText value="#{notif.formattedDate}" />
			                	
				    	</rich:dataGrid>
			    	</a4j:form>
				</rich:panel>
				
				<rich:panel id="sentbox">
					<f:facet name="header">
						<h:outputText value="Elementos Enviados"></h:outputText>
					</f:facet>
					<a4j:form>
						<p align="right">
							<a4j:commandButton value="Anterior" reRender="sentbox" action="#{notificationsBean.sentNotificationPreviousPage}"/>
							<em><h:outputText value=" Pagina #{notificationsBean.sentNotificationsPage} de #{notificationsBean.maxSentNotificationsPage} "/></em>
							<a4j:commandButton value="Siguiente" reRender="sentbox" action="#{notificationsBean.sentNotificationNextPage}"/><br/>
						</p>
						<rich:dataGrid value="#{notificationsBean.notificacionesEnviadas}" var="notif" columns="1" elements="10" width="938px"
						onRowClick="document.getElementById('modalSubject').innerHTML = '&lt;strong&gt;#{notif.subject}&lt;/strong&gt;'; 
						document.getElementById('modalInfo').innerHTML = 'De #{notif.userFrom} Para #{notif.userTo}, #{notif.formattedDate}'; 
						document.getElementById('modalBody').innerHTML = '#{notif.HTMLText}'; #{rich:component('panel')}.show()">
				        	<h:graphicImage value="images/messages/msg_write.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				        	<strong><h:outputText value="#{notif.subject}" style="margin-left:5px"/><br /></strong>
				        	<h:outputText value="#{notif.userFrom} - " style="font-style:italic"/>
			                <h:outputText value="#{notif.formattedDate}" />					
				    	</rich:dataGrid>
				    </a4j:form>
				</rich:panel>
				
				<rich:panel id="notif">
					<f:facet name="header">
						<h:outputText value="Notificaciones Recibidas"></h:outputText>
					</f:facet>
					<a4j:form>
						<p align="right">
							<a4j:commandButton value="Anterior" reRender="notif" action="#{notificationsBean.gralNotificationsPreviousPage}"/>
							<em><h:outputText value=" Pagina #{notificationsBean.gralNotificationsPage} de #{notificationsBean.maxGralNotificationsPage} "/></em>
							<a4j:commandButton value="Siguiente" reRender="notif" action="#{notificationsBean.gralNotificationsNextPage}"/><br/>
						</p>
						<rich:dataGrid value="#{notificationsBean.notificacionesGeneral}" var="notif" columns="1" elements="10" width="938px"
						onRowClick="document.getElementById('modalSubject').innerHTML = '&lt;strong&gt;#{notif.subject}&lt;/strong&gt;'; 
						document.getElementById('modalInfo').innerHTML = 'De #{notif.userFrom} Para #{notif.userTo}, #{notif.formattedDate}'; 
						document.getElementById('modalBody').innerHTML = '#{notif.HTMLText}'; #{rich:component('panel')}.show()">
				        	<h:graphicImage value="images/messages/msg_write.gif" style="padding-bottom: 4px; vertical-align: middle;"/>
				        	<strong><h:outputText value="#{notif.subject}" style="margin-left:5px"/><br /></strong>
				        	<h:outputText value="#{notif.userFrom} - " style="font-style:italic"/>
			                <h:outputText value="#{notif.formattedDate}" />					
				    	</rich:dataGrid>
				    </a4j:form>
				</rich:panel>
				
				<rich:effect for="window" event="onload" type="Fade" params="targetId:'write'"/>
				<rich:effect for="window" event="onload" type="Fade" params="targetId:'sentbox'"/>
				<rich:effect for="window" event="onload" type="Fade" params="targetId:'notif'"/>
							   		
	</ui:define>
</ui:composition>
</html>
